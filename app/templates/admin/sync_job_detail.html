{% extends "admin/base_admin.html" %}

{% block title %}Sync Job{% endblock %}
{% block page_title %}Sync Job #{{ job.id }}{% endblock %}

{% block content %}
<div class="card admin-card p-4">
    <div class="mb-3">
        <a href="{{ url_for('admin.sync_jobs') }}" class="btn btn-sm btn-outline-secondary">
            <i class="bi bi-arrow-left"></i> Zurueck
        </a>
        {% if job.status == 'queued' %}
        <form method="POST" action="{{ url_for('admin.cancel_sync_job', job_id=job.id) }}" class="d-inline" onsubmit="return confirm('Job abbrechen?');">
            <button type="submit" class="btn btn-sm btn-outline-danger">
                <i class="bi bi-x-circle"></i> Abbrechen
            </button>
        </form>
        {% endif %}
    </div>
    <div class="row g-3 mb-3">
        <div class="col-md-4">
            <div class="small text-muted">Status</div>
            <div>
                {% if job.status == 'success' %}
                <span class="badge bg-success">Erfolgreich</span>
                {% elif job.status == 'failed' %}
                <span class="badge bg-danger">Fehlgeschlagen</span>
                {% elif job.status == 'running' %}
                <span class="badge bg-warning text-dark">Laeuft</span>
                {% else %}
                <span class="badge bg-secondary">Warteschlange</span>
                {% endif %}
            </div>
        </div>
        <div class="col-md-4">
            <div class="small text-muted">Fortschritt</div>
            <div>{{ job.completed_steps }}/{{ job.total_steps }}</div>
        </div>
        <div class="col-md-4">
            <div class="small text-muted">Erstellt</div>
            <div>{{ job.created_at.strftime('%d.%m.%Y %H:%M') if job.created_at else '' }}</div>
        </div>
        <div class="col-md-4">
            <div class="small text-muted">Gestartet</div>
            <div>{{ job.started_at.strftime('%d.%m.%Y %H:%M') if job.started_at else '-' }}</div>
        </div>
        <div class="col-md-4">
            <div class="small text-muted">Beendet</div>
            <div>{{ job.finished_at.strftime('%d.%m.%Y %H:%M') if job.finished_at else '-' }}</div>
        </div>
        <div class="col-md-4">
            <div class="small text-muted">Erstellt / Uebersprungen</div>
            <div>{{ job.added_count }} / {{ job.skipped_count }}</div>
        </div>
    </div>

    {% if job.error_message %}
    <div class="alert alert-danger small">{{ job.error_message }}</div>
    {% endif %}

    <label class="form-label fw-500">Log</label>
    <pre class="bg-light p-3 small" style="white-space: pre-wrap;">{{ job.log or 'Kein Log vorhanden.' }}</pre>
</div>
{% endblock %}
