{% extends "admin/base_admin.html" %}

{% block title %}Blog KI-Generator{% endblock %}
{% block page_title %}Blog KI-Generator Einstellungen{% endblock %}

{% block content %}

<div class="row g-4">
    <!-- Settings -->
    <div class="col-lg-5">
        <div class="card admin-card p-4">
            <h6 class="fw-bold mb-3"><i class="bi bi-gear me-2 text-accent"></i>Automatische Generierung</h6>
            <form method="POST">
                <div class="mb-3">
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="autoEnabled" name="auto_enabled" value="on" {% if settings.auto_enabled == 'on' %}checked{% endif %}>
                        <label class="form-check-label fw-500" for="autoEnabled">Automatische Generierung aktiviert</label>
                    </div>
                    <small class="text-muted">Wenn aktiviert, werden Artikel automatisch nach Zeitplan generiert (Mo/Mi/Fr 8:00)</small>
                </div>
                <div class="mb-3">
                    <label class="form-label fw-500">Artikel pro Durchlauf</label>
                    <select class="form-select" name="posts_per_run">
                        {% for i in range(1, 6) %}
                        <option value="{{ i }}" {% if settings.posts_per_run == i|string %}selected{% endif %}>{{ i }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="mb-3">
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="autoPublish" name="auto_publish" value="on" {% if settings.auto_publish == 'on' %}checked{% endif %}>
                        <label class="form-check-label fw-500" for="autoPublish">Automatisch veröffentlichen</label>
                    </div>
                    <small class="text-muted">Wenn deaktiviert, werden Artikel als Entwurf erstellt</small>
                </div>
                <div class="mb-3">
                    <label class="form-label fw-500">Standard-Kategorie</label>
                    <select class="form-select" name="default_category">
                        <option value="">Automatisch erkennen</option>
                        <option value="Neue Kollektionen" {% if settings.default_category == 'Neue Kollektionen' %}selected{% endif %}>Neue Kollektionen</option>
                        <option value="Design-Trends" {% if settings.default_category == 'Design-Trends' %}selected{% endif %}>Design-Trends</option>
                        <option value="Fliesen-Ratgeber" {% if settings.default_category == 'Fliesen-Ratgeber' %}selected{% endif %}>Fliesen-Ratgeber</option>
                        <option value="Projekte & Referenzen" {% if settings.default_category == 'Projekte & Referenzen' %}selected{% endif %}>Projekte & Referenzen</option>
                        <option value="Pflege & Wartung" {% if settings.default_category == 'Pflege & Wartung' %}selected{% endif %}>Pflege & Wartung</option>
                        <option value="Showroom News" {% if settings.default_category == 'Showroom News' %}selected{% endif %}>Showroom News</option>
                    </select>
                </div>
                <button type="submit" class="btn btn-accent">
                    <i class="bi bi-check-lg me-1"></i>Einstellungen speichern
                </button>
            </form>
        </div>

        <!-- Info Card -->
        <div class="card admin-card p-4 mt-4">
            <h6 class="fw-bold mb-3"><i class="bi bi-info-circle me-2"></i>So funktioniert es</h6>
            <ul class="list-unstyled small text-muted mb-0">
                <li class="mb-2"><i class="bi bi-1-circle text-accent me-2"></i>Nachrichtenquellen sammeln aktuelle Meldungen (RSS, Hersteller-Websites)</li>
                <li class="mb-2"><i class="bi bi-2-circle text-accent me-2"></i>KI (OpenAI) erstellt SEO-optimierte Artikel auf Deutsch</li>
                <li class="mb-2"><i class="bi bi-3-circle text-accent me-2"></i>Artikel werden als Entwurf gespeichert oder automatisch veröffentlicht</li>
                <li class="mb-2"><i class="bi bi-4-circle text-accent me-2"></i>Jeder Artikel enthält einen CTA zum Showroom-Besuch</li>
                <li><i class="bi bi-currency-euro text-accent me-2"></i>Kosten: ca. 0.001-0.003 EUR pro Artikel (gpt-4o-mini)</li>
            </ul>
        </div>
    </div>

    <!-- Generation Log -->
    <div class="col-lg-7">
        <div class="card admin-card p-4">
            <h6 class="fw-bold mb-3"><i class="bi bi-clock-history me-2"></i>Generierungsprotokoll</h6>
            {% if logs %}
            <div class="table-responsive">
                <table class="table table-hover table-sm align-middle mb-0">
                    <thead class="table-light">
                        <tr>
                            <th>Datum</th>
                            <th>Typ</th>
                            <th>Status</th>
                            <th>Tokens</th>
                            <th>Kosten</th>
                            <th>Details</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for log in logs %}
                        <tr>
                            <td class="small">{{ log.created_at.strftime('%d.%m.%Y %H:%M') if log.created_at else '' }}</td>
                            <td>
                                {% if log.source_type == 'manual' %}
                                <span class="badge bg-primary">Manuell</span>
                                {% elif log.source_type == 'rss' %}
                                <span class="badge bg-info">RSS</span>
                                {% elif log.source_type == 'manufacturer_content' %}
                                <span class="badge bg-secondary">Hersteller</span>
                                {% elif log.source_type == 'topic' %}
                                <span class="badge bg-light text-dark">Thema</span>
                                {% else %}
                                <span class="badge bg-light text-dark">{{ log.source_type or 'Unbekannt' }}</span>
                                {% endif %}
                            </td>
                            <td>
                                {% if log.status == 'success' %}
                                <span class="text-success"><i class="bi bi-check-circle"></i></span>
                                {% else %}
                                <span class="text-danger"><i class="bi bi-x-circle"></i></span>
                                {% endif %}
                            </td>
                            <td class="small text-muted">{{ log.tokens_used or '-' }}</td>
                            <td class="small text-muted">{% if log.cost_estimate %}{{ "%.4f"|format(log.cost_estimate) }} EUR{% else %}-{% endif %}</td>
                            <td>
                                {% if log.blog_post %}
                                <a href="{{ url_for('admin.edit_blog_post', post_id=log.blog_post_id) }}" class="small text-decoration-none">{{ log.blog_post.title[:30] }}...</a>
                                {% elif log.error_message %}
                                <small class="text-danger">{{ log.error_message[:40] }}...</small>
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <p class="text-muted small mb-0">Noch keine Generierungen durchgefuehrt.</p>
            {% endif %}
        </div>
    </div>
</div>

{% endblock %}
