{% extends "admin/base_admin.html" %}

{% block title %}{{ manufacturer.name }} - Inhalt verwalten{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h2>
            {% set logo_path = manufacturer_logos.get(manufacturer.slug, '') %}
            {% if logo_path %}
            <img src="{{ url_for('static', filename='uploads/' + logo_path) }}" 
                 alt="{{ manufacturer.name }}" 
                 class="manufacturer-logo me-2"
                 style="max-height: 40px;">
            {% endif %}
            {{ manufacturer.name }} - Inhalt
        </h2>
        <p class="text-muted">Verwalten Sie Kollektionen, Projekte und Blog-Posts</p>
    </div>
    <div>
        <a href="{{ url_for('admin.manage_manufacturers') }}" class="btn btn-secondary">
            <i class="bi bi-arrow-left"></i> Zurück
        </a>
        <form method="POST" action="{{ url_for('admin.sync_manufacturer_content', manufacturer_id=manufacturer.id) }}" 
              class="d-inline">
            <button type="submit" class="btn btn-primary" 
                    onclick="return confirm('Neue Inhalte synchronisieren? Dies kann einige Minuten dauern.')">
                <i class="bi bi-arrow-repeat"></i> Synchronisieren
            </button>
        </form>
    </div>
</div>

<!-- Tabs -->
<ul class="nav nav-tabs mb-4" role="tablist">
    <li class="nav-item" role="presentation">
        <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#collections" type="button">
            <i class="bi bi-grid-3x3"></i> Kollektionen <span class="badge bg-secondary">{{ collections|length }}</span>
        </button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link" data-bs-toggle="tab" data-bs-target="#projects" type="button">
            <i class="bi bi-building"></i> Projekte <span class="badge bg-secondary">{{ projects|length }}</span>
        </button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link" data-bs-toggle="tab" data-bs-target="#blog" type="button">
            <i class="bi bi-newspaper"></i> News <span class="badge bg-secondary">{{ blog_posts|length }}</span>
        </button>
    </li>
</ul>

<div class="tab-content">
    <!-- Kollektionen -->
    <div class="tab-pane fade show active" id="collections">
        {% if collections %}
        <div class="table-responsive">
            <table class="table table-hover">
                <thead>
                    <tr>
                        <th style="width: 80px;">Bild</th>
                        <th>Titel</th>
                        <th>Beschreibung</th>
                        <th style="width: 100px;">Status</th>
                        <th style="width: 180px;">Aktionen</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in collections %}
                    <tr>
                        <td>
                            {% if item.image_url %}
                            <img src="{{ url_for('static', filename='uploads/' + item.image_url) }}" 
                                 class="img-thumbnail" style="max-width: 60px; max-height: 60px;">
                            {% else %}
                            <div class="bg-light d-flex align-items-center justify-content-center" 
                                 style="width: 60px; height: 60px;">
                                <i class="bi bi-image text-muted"></i>
                            </div>
                            {% endif %}
                        </td>
                        <td>
                            <strong>{{ item.title }}</strong>
                            {% if item.source_url %}
                            <br><small class="text-muted">
                                <i class="bi bi-link-45deg"></i> 
                                <a href="{{ item.source_url }}" target="_blank">Quelle</a>
                            </small>
                            {% endif %}
                        </td>
                        <td>
                            <small>{{ item.description[:100] }}{% if item.description and item.description|length > 100 %}...{% endif %}</small>
                        </td>
                        <td>
                            <form method="POST" 
                                  action="{{ url_for('admin.toggle_publish_content', content_id=item.id) }}" 
                                  class="d-inline">
                                <button type="submit" class="btn btn-sm {{ 'btn-success' if item.published else 'btn-secondary' }}">
                                    {% if item.published %}
                                        <i class="bi bi-eye"></i> Sichtbar
                                    {% else %}
                                        <i class="bi bi-eye-slash"></i> Verborgen
                                    {% endif %}
                                </button>
                            </form>
                        </td>
                        <td>
                            <a href="{{ url_for('admin.edit_manufacturer_content', content_id=item.id) }}" 
                               class="btn btn-sm btn-outline-primary">
                                <i class="bi bi-pencil"></i> Bearbeiten
                            </a>
                            <form method="POST" 
                                  action="{{ url_for('admin.delete_manufacturer_content', content_id=item.id) }}" 
                                  class="d-inline"
                                  onsubmit="return confirm('Wirklich löschen?')">
                                <button type="submit" class="btn btn-sm btn-outline-danger">
                                    <i class="bi bi-trash"></i>
                                </button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="alert alert-info">
            <i class="bi bi-info-circle"></i> Keine Kollektionen gefunden. 
            Klicken Sie auf "Synchronisieren", um Inhalte zu laden.
        </div>
        {% endif %}
    </div>

    <!-- Projekte -->
    <div class="tab-pane fade" id="projects">
        {% if projects %}
        <div class="table-responsive">
            <table class="table table-hover">
                <thead>
                    <tr>
                        <th style="width: 80px;">Bild</th>
                        <th>Titel</th>
                        <th>Beschreibung</th>
                        <th style="width: 100px;">Status</th>
                        <th style="width: 180px;">Aktionen</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in projects %}
                    <tr>
                        <td>
                            {% if item.image_url %}
                            <img src="{{ url_for('static', filename='uploads/' + item.image_url) }}" 
                                 class="img-thumbnail" style="max-width: 60px; max-height: 60px;">
                            {% else %}
                            <div class="bg-light d-flex align-items-center justify-content-center" 
                                 style="width: 60px; height: 60px;">
                                <i class="bi bi-image text-muted"></i>
                            </div>
                            {% endif %}
                        </td>
                        <td>
                            <strong>{{ item.title }}</strong>
                            {% if item.source_url %}
                            <br><small class="text-muted">
                                <i class="bi bi-link-45deg"></i> 
                                <a href="{{ item.source_url }}" target="_blank">Quelle</a>
                            </small>
                            {% endif %}
                        </td>
                        <td>
                            <small>{{ item.description[:100] }}{% if item.description and item.description|length > 100 %}...{% endif %}</small>
                        </td>
                        <td>
                            <form method="POST" 
                                  action="{{ url_for('admin.toggle_publish_content', content_id=item.id) }}" 
                                  class="d-inline">
                                <button type="submit" class="btn btn-sm {{ 'btn-success' if item.published else 'btn-secondary' }}">
                                    {% if item.published %}
                                        <i class="bi bi-eye"></i> Sichtbar
                                    {% else %}
                                        <i class="bi bi-eye-slash"></i> Verborgen
                                    {% endif %}
                                </button>
                            </form>
                        </td>
                        <td>
                            <a href="{{ url_for('admin.edit_manufacturer_content', content_id=item.id) }}" 
                               class="btn btn-sm btn-outline-primary">
                                <i class="bi bi-pencil"></i> Bearbeiten
                            </a>
                            <form method="POST" 
                                  action="{{ url_for('admin.delete_manufacturer_content', content_id=item.id) }}" 
                                  class="d-inline"
                                  onsubmit="return confirm('Wirklich löschen?')">
                                <button type="submit" class="btn btn-sm btn-outline-danger">
                                    <i class="bi bi-trash"></i>
                                </button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="alert alert-info">
            <i class="bi bi-info-circle"></i> Keine Projekte gefunden.
        </div>
        {% endif %}
    </div>

    <!-- News -->
    <div class="tab-pane fade" id="blog">
        {% if blog_posts %}
        <div class="table-responsive">
            <table class="table table-hover">
                <thead>
                    <tr>
                        <th style="width: 80px;">Bild</th>
                        <th>Titel</th>
                        <th>Beschreibung</th>
                        <th style="width: 100px;">Status</th>
                        <th style="width: 180px;">Aktionen</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in blog_posts %}
                    <tr>
                        <td>
                            {% if item.image_url %}
                            <img src="{{ url_for('static', filename='uploads/' + item.image_url) }}" 
                                 class="img-thumbnail" style="max-width: 60px; max-height: 60px;">
                            {% else %}
                            <div class="bg-light d-flex align-items-center justify-content-center" 
                                 style="width: 60px; height: 60px;">
                                <i class="bi bi-image text-muted"></i>
                            </div>
                            {% endif %}
                        </td>
                        <td>
                            <strong>{{ item.title }}</strong>
                            {% if item.source_url %}
                            <br><small class="text-muted">
                                <i class="bi bi-link-45deg"></i> 
                                <a href="{{ item.source_url }}" target="_blank">Quelle</a>
                            </small>
                            {% endif %}
                        </td>
                        <td>
                            <small>{{ item.description[:100] }}{% if item.description and item.description|length > 100 %}...{% endif %}</small>
                        </td>
                        <td>
                            <form method="POST" 
                                  action="{{ url_for('admin.toggle_publish_content', content_id=item.id) }}" 
                                  class="d-inline">
                                <button type="submit" class="btn btn-sm {{ 'btn-success' if item.published else 'btn-secondary' }}">
                                    {% if item.published %}
                                        <i class="bi bi-eye"></i> Sichtbar
                                    {% else %}
                                        <i class="bi bi-eye-slash"></i> Verborgen
                                    {% endif %}
                                </button>
                            </form>
                        </td>
                        <td>
                            <a href="{{ url_for('admin.edit_manufacturer_content', content_id=item.id) }}" 
                               class="btn btn-sm btn-outline-primary">
                                <i class="bi bi-pencil"></i> Bearbeiten
                            </a>
                            <form method="POST" 
                                  action="{{ url_for('admin.delete_manufacturer_content', content_id=item.id) }}" 
                                  class="d-inline"
                                  onsubmit="return confirm('Wirklich löschen?')">
                                <button type="submit" class="btn btn-sm btn-outline-danger">
                                    <i class="bi bi-trash"></i>
                                </button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="alert alert-info">
            <i class="bi bi-info-circle"></i> Keine News gefunden.
        </div>
        {% endif %}
    </div>
</div>

{% endblock %}
