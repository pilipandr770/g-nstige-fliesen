{% extends "admin/base_admin.html" %}

{% block title %}Kollektion verwalten{% endblock %}
{% block page_title %}Beliebte Kollektionen{% endblock %}

{% block content %}

<div class="row g-4">
    <!-- Add/Edit Form -->
    <div class="col-lg-5">
        <div class="card admin-card p-4 sticky-top" style="top: 90px;">
            <h6 class="fw-bold mb-3"><i class="bi bi-plus-circle me-2 text-accent"></i>Neue Kollektion</h6>

            <form method="POST" enctype="multipart/form-data" id="collectionForm">
                <input type="hidden" name="collection_id" id="collectionId" value="">
                
                <div class="mb-3">
                    <label class="form-label fw-500">Titel *</label>
                    <input type="text" class="form-control" name="title" id="title" placeholder="z.B. Marmor Optik" required>
                </div>

                <div class="mb-3">
                    <label class="form-label fw-500">Untertitel (optional)</label>
                    <input type="text" class="form-control" name="subtitle" id="subtitle" placeholder="z.B. Eleganz für Ihr Badezimmer">
                </div>

                <div class="mb-3">
                    <label class="form-label fw-500">Beschreibung (optional)</label>
                    <textarea class="form-control" name="description" id="description" rows="2" placeholder="Weitere Details..."></textarea>
                </div>

                <div class="mb-3">
                    <label class="form-label fw-500">Hintergrundbild (optional)</label>
                    <input type="file" class="form-control" name="file" accept="image/*">
                    <small class="text-muted d-block mt-2">PNG, JPG, GIF, WebP (max. 5MB)</small>
                </div>

                <div class="mb-3">
                    <label class="form-label fw-500">Link zur Kollektion (optional)</label>
                    <input type="url" class="form-control" name="link_url" id="link_url" placeholder="https://...">
                </div>

                <div class="d-grid gap-2">
                    <button type="submit" class="btn btn-accent">
                        <i class="bi bi-check-lg me-1"></i><span id="submitText">Speichern</span>
                    </button>
                    <button type="reset" class="btn btn-outline-secondary" onclick="resetForm()">
                        <i class="bi bi-arrow-counterclockwise me-1"></i>Zurücksetzen
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Collections List -->
    <div class="col-lg-7">
        <div class="card admin-card p-4">
            <h6 class="fw-bold mb-3"><i class="bi bi-grid me-2"></i>Alle Kollektionen</h6>

            {% if collections %}
            <div class="row g-3">
                {% for collection in collections %}
                <div class="col-md-6">
                    <div class="card border-0 h-100 collection-card" style="cursor: pointer;">
                        {% if collection.filename %}
                        <img src="/static/uploads/{{ collection.filename }}" class="card-img-top" style="height: 180px; object-fit: cover; border-radius: 8px 8px 0 0;" alt="{{ collection.title }}">
                        {% else %}
                        <div style="height: 180px; background: linear-gradient(135deg, rgba(176,141,87,0.2), rgba(176,141,87,0.05)); border-radius: 8px 8px 0 0; display: flex; align-items: center; justify-content: center;">
                            <i class="bi bi-image" style="font-size: 3rem; color: rgba(176,141,87,0.3);"></i>
                        </div>
                        {% endif %}
                        <div class="card-body p-3">
                            <h6 class="card-title mb-1">{{ collection.title }}</h6>
                            {% if collection.subtitle %}
                            <p class="small text-muted mb-2">{{ collection.subtitle[:50] }}</p>
                            {% endif %}
                            <div class="d-flex gap-2">
                                <button type="button" class="btn btn-sm btn-outline-primary flex-grow-1" onclick="editCollection({{ collection.id }}, '{{ collection.title }}', '{{ collection.subtitle or '' }}', '{{ collection.description or '' }}', '{{ collection.link_url or '' }}')">
                                    <i class="bi bi-pencil"></i> Ändern
                                </button>
                                <a href="{{ url_for('admin.delete_collection', collection_id=collection.id) }}" 
                                   class="btn btn-sm btn-outline-danger" 
                                   onclick="return confirm('Wirklich löschen?')">
                                    <i class="bi bi-trash"></i>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="text-center py-5">
                <i class="bi bi-grid display-4 text-muted mb-3 d-block"></i>
                <p class="text-muted mb-0">Noch keine Kollektionen vorhanden</p>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<!-- Preview -->
<div class="row mt-4">
    <div class="col-12">
        <div class="card admin-card p-4">
            <h6 class="fw-bold mb-3"><i class="bi bi-eye me-2"></i>Vorschau – Startseite</h6>
            
            <div class="row g-3">
                {% for collection in collections %}
                <div class="col-lg-4">
                    <div class="collection-preview rounded-3 overflow-hidden" style="height: 300px; position: relative; cursor: pointer;">
                        {% if collection.filename %}
                        <img src="/static/uploads/{{ collection.filename }}" style="width: 100%; height: 100%; object-fit: cover;">
                        {% else %}
                        <div style="width: 100%; height: 100%; background: linear-gradient(135deg, rgba(176,141,87,0.3), rgba(176,141,87,0.05));"></div>
                        {% endif %}
                        <div class="position-absolute top-0 start-0 end-0 bottom-0 d-flex flex-column justify-content-end p-3" style="background: linear-gradient(to top, rgba(0,0,0,0.6) 0%, transparent 60%);">
                            <h5 class="text-white mb-0">{{ collection.title }}</h5>
                            {% if collection.subtitle %}
                            <small class="text-white-50">{{ collection.subtitle }}</small>
                            {% endif %}
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>

<script>
function editCollection(id, title, subtitle, description, link_url) {
    document.getElementById('collectionId').value = id;
    document.getElementById('title').value = title;
    document.getElementById('subtitle').value = subtitle;
    document.getElementById('description').value = description;
    document.getElementById('link_url').value = link_url;
    document.getElementById('submitText').textContent = 'Aktualisieren';
    document.getElementById('collectionForm').scrollIntoView({ behavior: 'smooth' });
}

function resetForm() {
    document.getElementById('collectionId').value = '';
    document.getElementById('submitText').textContent = 'Speichern';
}
</script>

{% endblock %}
